<html>
    <head>
        <title>Tic Tac Toe</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script src="../assets/js/jquery.js" type="text/javascript"></script>
        <script type="text/javascript">
            var game = function (element)
            {
                var constants = {cross: 'X', circle: 'O'};
                var players = [constants.cross, constants.circle];
                var ele = $(element);
                var boxes = ele.children();
                var $this = this;
                var arr = new Array(9);
                var turn = 0;
                var winner = null;
                var botToPlay;

                var playerNum = 1;      // single player=>1 

                this.init = function () {
                    boxes.empty();
//                    $this.shufflePlayers();
                    boxes.unbind();
                    boxes.click(function (e) {
                        $this.fillBox($(this));
                    });
                };

                this.shufflePlayers = function () {
                    var tempIndex = Math.floor(Math.random() * 2);
                    var temp = players[tempIndex];
                    players[tempIndex] = players[0];
                    players[0] = temp;
                };

                this.fillBox = function (box) {
                    var ind = box.index();
                    if (arr[ind] != constants.cross && arr[ind] != constants.circle)
                    {
                        arr[ind] = players[turn % 2];
                        turn++;
                        box.text(arr[ind]);
                    }
                    $this.checkWin();
                };

                this.checkWinLogic = function (arr) {
                    var winner = null;
                    if (arr[0] == arr[1] && arr[1] == arr[2] && arr[0] != null)
                        winner = arr[0];
                    if (arr[3] == arr[4] && arr[4] == arr[5] && arr[3] != null)
                        winner = arr[3];
                    if (arr[6] == arr[7] && arr[7] == arr[8] && arr[6] != null)
                        winner = arr[6];
                    if (arr[0] == arr[3] && arr[3] == arr[6] && arr[0] != null)
                        winner = arr[0];
                    if (arr[1] == arr[4] && arr[4] == arr[7] && arr[1] != null)
                        winner = arr[1];
                    if (arr[2] == arr[5] && arr[5] == arr[8] && arr[2] != null)
                        winner = arr[2];
                    if (arr[0] == arr[4] && arr[4] == arr[8] && arr[0] != null)
                        winner = arr[0];
                    if (arr[2] == arr[4] && arr[4] == arr[6] && arr[2] != null)
                        winner = arr[2];
                    return winner;
                }

                this.checkWin = function () {
                    Utility.printMatrix(arr);
                    winner = $this.checkWinLogic(arr);

                    if (winner) {
                        boxes.unbind();
                        if (Utility.askUser("Winner: " + winner + ". Restart Game?"))
                            $this.restartGame();
                    }
                    $this.checkTie();
                };

                this.checkTie = function () {
                    var full = true;
                    for (var i = 0; i < arr.length; i++)
                        if (arr[i] == null)
                            full = false;
                    if (full)
                    {
                        boxes.unbind();
                        if (Utility.askUser("No winner: Khichadi. Restart Game?"))
                            $this.restartGame();
                    }
                };

                this.restartGame = function () {
                    arr = new Array(9);
                    turn = 0;
                    winner = null;
                    $this.init();
                }

                this.botTurn = function () {
                    botToPlay = -1;
                    arr = [
                        null, 'X', null,
                        null, null, 'X',
                        'O', 'O', 'X'
                    ];
                    this.miniMax(arr.slice(), players[turn % 2], [], -10, 10);
//                    this.miniMax(, players[turn % 2], []);
                    var $box = ele.children().eq(botToPlay).click();
//                    console.log(ele.children());
//                    console.log($box);
                };

                this.miniMax = function (arr, tempTurn, path, alpha, beta) {

                    if (botToPlay != -1) {
//                        return;
                    }
//                    arr = arr.splice();
                    for (var i = 0; i < 9; i++) {
                        arr[i] = arr[i];
                    }

                    var calcPoints = checkWinner();

                    console.log('Winner ' + calcPoints);
                    console.log('Turn - ' + tempTurn);
                    Utility.printMatrix(arr);
                    console.log('Path ', path);

                    if (calcPoints) {
                        return calcPoints;
                    }
//                    if (calcPoints == 10) {
//                        console.log('winnnnnnnnnnnnnn ', path);
//                        botToPlay = path[0].split('-')[1];
//                        return;
//                    }
//
//                    else if (calcPoints == -10) {
//                        console.log('Loserrrrrrrrrrr ', path);
//                        return;
//                    }
//
//                    else if (calcPoints == 0) {
//                        console.log('Drawwwwwwwwwww ', path);
//                        return;
//                    }

//                    console.log();


                    var temp = [];
                    var tempPath = [];

                    for (var i = 0; i < 9; i++) {
                        initTempArr();
                        if (temp[i] == undefined) {
                            temp[i] = tempTurn;
                            tempPath.push(tempTurn + '-' + i);
                            if (tempTurn == 'X') {
                                tempTurn = 'O';
                            }
                            else if (tempTurn == 'O') {
                                tempTurn = 'X';
                            }
                            var val = this.miniMax(temp, tempTurn, tempPath, alpha, beta);

                            if (tempTurn == 'X') {
                                if (val < beta) {
                                    beta = val;
                                }
                                if (beta <= alpha) {
                                    return alpha;
                                }
                            }
                            else if (tempTurn == 'O') {
                                if (val > alpha)
                                    alpha = val;
                                if (alpha >= beta)
                                    return beta;
                            }

                            if (tempTurn == 'O') {
                                return alpha;
                            }
                            else {
                                return beta;
                            }
                        }
                    }

                    function initTempArr() {
                        tempPath = path.slice();
                        for (var i = 0; i < 9; i++) {
                            temp[i] = arr[i];
                        }
                    }

                    function checkWinner() {
                        var me = 'X';
                        var you = 'O';
                        var winner = $this.checkWinLogic(arr);
                        if (winner == me) {
                            return 10;
                        }
                        else if (winner == you) {
                            return -10;
                        }
                        else {
                            var full = true;
                            for (var i = 0; i < arr.length; i++)
                                if (arr[i] == null)
                                    full = false;
                            if (full) {
                                return 0;
                            }
                        }
                    }

                }

                this.init();
//                console.log(arr)
            };

            var ticTac;

            $(function ()
            {
                ticTac = new game('#abc');
            });


            var Utility = {
//                showMessage: function (str) {
//                    window.alert(str);
//                },
//                getRandomBox: function (ar) {
//                    var temp = [];
//                    for (var i = 0; i < ar.length; i++)
//                    {
//                        if (ar[i] == null)
//                            temp.push(i);
//                    }
//                    return temp;
//                },
                printMatrix: function (arr) {
                    console.log('Array: ');
                    for (i = 0; i < 3; i++) {
                        var m = arr[i * 3 + 0] ? arr[i * 3 + 0] : ' ';
                        var l = arr[i * 3 + 1] ? arr[i * 3 + 1] : ' ';
                        var n = arr[i * 3 + 2] ? arr[i * 3 + 2] : ' ';
                        console.log(m + ' , ' + l + ' , ' + n);
                    }
                },
                askUser: function (str)
                {
                    return window.confirm(str);
                }
            };





        </script>
        <style>
            ul.container{overflow: hidden; width: 306px; margin: auto; list-style: none;}
            ul.container li{float: left; width: 100px;  font-size: 30px; line-height: 100px; height: 100px; text-transform: uppercase; text-align: center; border: 1px solid #000; font-weight: bold; cursor: pointer; }
        </style>
    </head>
    <body>
        <ul class="container" id="abc">
            <li>X</li>
            <li>X</li>
            <li>X</li>
            <li>o</li>
            <li>X</li>
            <li>X</li>
            <li>X</li>
            <li>X</li>
            <li>X</li>
        </ul>
    </body>
</html>
